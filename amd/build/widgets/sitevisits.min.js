/**
 * Site visits - chart init.
 *
 * @module     report_lmsace_reports/sitevisits
 * @copyright  2023 LMSACE <https://lmsace.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_lmsace_reports/widgets/sitevisits",["jquery","core/ajax","core/loadingicon","core/chartjs","report_lmsace_reports/chartjs-plugin-datalabels"],(function($,AJAX,LoadIcon){var visitchart=null,loadiconElement=$(".site-visits-block .loadiconElement");var showVisitChart=function(main,label,datavalue){let ctx=document.getElementById("site-visits-chart");if(ctx){var bgColor=main.getRandomColors(["c7"],".5",!0),borderColor=main.getRandomColors(["c7"]),bgColor2=main.getRandomColors(["c4"],".5",!0),borderColor2=main.getRandomColors(["c4"]),bgColor3=main.getRandomColors(["c6"],".5",!0),borderColor3=main.getRandomColors(["c6"]),customConfig={options:main.getMultiDatasetOptions(),data:{datasets:[{label:ctx.dataset.sitevisits,data:datavalue.sitevisits,backgroundColor:bgColor,borderColor:borderColor,fill:!0,datalabels:{align:-45}},{label:ctx.dataset.coursevisits,data:datavalue.coursevisits,backgroundColor:bgColor2,borderColor:borderColor2,fill:!0,datalabels:{align:"left"}},{label:ctx.dataset.modulevisits,data:datavalue.modulevisits,backgroundColor:bgColor3,borderColor:borderColor3,fill:!0,datalabels:{align:45}}]}};visitchart=main.buildChart(ctx,"line",label,null,null,customConfig)}},getVisitsRecords=function(filter){filter||(filter="week");var request={methodname:"report_lmsace_reports_site_visits",args:{filter:filter,chartid:"sitevisitswidget"}},promise=AJAX.call([request])[0];promise.done((function(result){updateChartData(result)})),LoadIcon.addIconToContainerRemoveOnCompletion(loadiconElement,promise)},updateChartData=function(data){visitchart.data.labels=data.label,visitchart.data.datasets[0].data=data.value.sitevisits,visitchart.data.datasets[1].data=data.value.coursevisits,visitchart.data.datasets[2].data=data.value.modulevisits,visitchart.update()};return{init:function(main){if("undefined"==typeof sitevisits)return null;var label=sitevisits.label,datavalue=sitevisits.value;return showVisitChart(main,label,datavalue),$(".site-visits-block .dropdown-menu a").click((function(){var selText=$(this).text(),filter=$(this).attr("value");$(this).parents(".dropdown").find("#daterangefiltermenu").html(selText+' <span class="caret"></span>'),$(this).parents(".dropdown").find("#daterangefiltermenu").attr("data-filter",filter),getVisitsRecords(filter)})),!0}}}));

//# sourceMappingURL=sitevisits.min.js.map